# Byte Dashboard v1 - Product Vision & Architecture

**Last Updated:** February 6, 2026
**Status:** Active Development - Frontend Foundation Complete, Backend Pending

---

## Core Identity

**Byte Dashboard** is a **lightweight system for tracking people through multi-step processes**.

Initially built for government agencies (Fayette County Sheriff's Office) to manage job applicant tracking. Focused on delivering a working MVP, not promising configurability or general-purpose expansion yet.

### The Problem It Solves

Organizations need to:
- Ingest workflow_executions/submissions from online forms (Formstack)
- Track people through multi-stage review processes (background checks, interviews, approvals)
- Manage tasks associated with each workflow instance
- Handle documents/assets throughout the process
- Maintain visibility into pipeline status
- Support multiple organizations (multi-tenant)

### Primary Use Case

- **Job Application Process** (Sheriff's Office hiring)

### Potential Future Use Cases

Organizations may discover other uses (onboarding, grants, vendor management), but we're not selling configurability or general-purpose workflows yet. Let customers find those properties; don't promise them.

---

## V1 Philosophy: Radical Simplification

The previous codebase had **65 tables, 325 migrations, 252-file workflow builder**â€”an AI-generated prototype that spiraled into enterprise complexity.

**V1 is a complete reset** focusing on:
- **Simple over complex** - Hardcode things initially, add configurability later
- **JSONB for flexibility** - Custom fields, metadata, status configs in JSONB columns
- **Build what's needed** - Not what might be needed someday
- **9-11 tables instead of 65**

---

## Mental Model

```
Contact (person/entity)
    â””â”€â”€ Workflow (instance of a process)
            â”œâ”€â”€ Tasks (steps to complete)
            â””â”€â”€ Assets (documents, files)
```

**That's it.** Everything else is configuration or metadata.

---

## Data Model (10-11 Tables)

### Entity Relationship Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Clerk       â”‚
â”‚  Organizations  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ org_id
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚      â”‚ workflow_       â”‚
â”‚  (Clerk sync)   â”‚      â”‚ templates       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â”‚ assigned_to            â”‚ template_id
         â”‚                        â”‚
         â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     tasks       â”‚â—„â”€â”€â”€â”€â”€â”‚   workflows     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                 â”‚                 â”‚
                â–¼                 â–¼                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  contacts   â”‚   â”‚   assets    â”‚  â”‚    notes    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Core Tables

#### `users` (Clerk sync)
```sql
CREATE TABLE users (
  id            TEXT PRIMARY KEY,        -- Clerk user ID
  org_id        TEXT NOT NULL,           -- Clerk org ID
  email         TEXT NOT NULL,
  first_name    TEXT,
  last_name     TEXT,
  role          TEXT DEFAULT 'user',     -- owner, admin, user
  created_at    TIMESTAMPTZ DEFAULT NOW(),
  updated_at    TIMESTAMPTZ DEFAULT NOW()
);
```

#### `contacts`
```sql
CREATE TABLE contacts (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id          TEXT NOT NULL,
  first_name      TEXT NOT NULL,
  last_name       TEXT NOT NULL,
  email           TEXT,
  phone           TEXT,
  address_line_1  TEXT,
  address_line_2  TEXT,
  city            TEXT,
  state           TEXT,
  zip             TEXT,
  metadata        JSONB DEFAULT '{}',    -- custom fields
  tags            TEXT[] DEFAULT '{}',   -- simple array
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```

#### `workflow_definitions`
```sql
CREATE TABLE workflow_definitions (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id      TEXT NOT NULL,
  name        TEXT NOT NULL,              -- "Job Application Process"
  description TEXT,
  category    TEXT,                       -- "hiring", "onboarding", "grants"
  statuses    JSONB NOT NULL DEFAULT '[]', -- ordered array of status objects
  is_active   BOOLEAN DEFAULT true,
  created_at  TIMESTAMPTZ DEFAULT NOW(),
  updated_at  TIMESTAMPTZ DEFAULT NOW()
);

-- Example statuses JSONB:
-- [
--   {"key": "submitted", "label": "Submitted", "color": "gray"},
--   {"key": "under_review", "label": "Under Review", "color": "blue"},
--   {"key": "background_check", "label": "Background Check", "color": "yellow"},
--   {"key": "interview", "label": "Interview", "color": "purple"},
--   {"key": "approved", "label": "Approved", "color": "green"},
--   {"key": "rejected", "label": "Rejected", "color": "red"}
-- ]
```

#### `workflows` (was "workflow_executions")
```sql
CREATE TABLE workflows (
  id                  UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id              TEXT NOT NULL,
  contact_id          UUID NOT NULL REFERENCES contacts(id),
  template_id         UUID REFERENCES workflow_definitions(id),
  status              TEXT NOT NULL DEFAULT 'draft',  -- Presentation-only, updated by Temporal activities
  source              TEXT DEFAULT 'manual',          -- manual, formstack, api
  source_id           TEXT,                           -- external reference ID
  submitted_at        TIMESTAMPTZ,
  metadata            JSONB DEFAULT '{}',
  created_at          TIMESTAMPTZ DEFAULT NOW(),
  updated_at          TIMESTAMPTZ DEFAULT NOW()
);

-- Note: Removed 'current_stage' (redundant with 'status')
-- Temporal workflow state is authoritative for progression
```

#### `tasks`
```sql
CREATE TABLE tasks (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id          TEXT NOT NULL,
  workflow_id     UUID REFERENCES workflows(id),
  contact_id      UUID REFERENCES contacts(id),
  assigned_to     TEXT REFERENCES users(id),
  title           TEXT NOT NULL,
  description     TEXT,
  status          TEXT NOT NULL DEFAULT 'todo',  -- todo, in_progress, done
  priority        TEXT DEFAULT 'medium',         -- low, medium, high
  position        INTEGER DEFAULT 0,             -- For drag-and-drop ordering (future)
  due_date        DATE,
  completed_at    TIMESTAMPTZ,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_tasks_org ON tasks(org_id);
CREATE INDEX idx_tasks_assigned ON tasks(assigned_to);
CREATE INDEX idx_tasks_status ON tasks(org_id, status);
CREATE INDEX idx_tasks_workflow ON tasks(workflow_id);
CREATE INDEX idx_tasks_position ON tasks(org_id, status, position);  -- For kanban ordering
```

#### `assets` (v1.5 - Stubbed for MVP)
```sql
-- Stubbed for v1.5. MVP: upload/download only, no previews/metadata UI.
CREATE TABLE assets (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id          TEXT NOT NULL,
  workflow_id     UUID REFERENCES workflows(id) ON DELETE CASCADE,
  contact_id      UUID REFERENCES contacts(id),

  file_name       TEXT NOT NULL,
  file_size       INTEGER,
  mime_type       TEXT,

  storage_key     TEXT NOT NULL,  -- Vercel Blob key
  storage_url     TEXT,           -- Signed URL (expires)

  uploaded_by     TEXT REFERENCES users(id),
  created_at      TIMESTAMPTZ DEFAULT NOW()
);

-- v1.5 additions (not in MVP):
-- - task_id FK (attachment to tasks)
-- - metadata JSONB (tags, descriptions, categories)
-- - Preview logic, thumbnails, OCR
-- - Quota tracking per org
-- - Orphan cleanup cron
```

#### `notes`
```sql
CREATE TABLE notes (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id      TEXT NOT NULL,
  entity_type TEXT NOT NULL,  -- 'workflow', 'contact', 'task' (for rendering)
  entity_id   UUID NOT NULL,
  -- Soft FKs for sane queries (nullable, indexed)
  workflow_id UUID REFERENCES workflows(id) ON DELETE CASCADE,
  contact_id  UUID REFERENCES contacts(id) ON DELETE CASCADE,
  task_id     UUID REFERENCES tasks(id) ON DELETE CASCADE,
  user_id     TEXT NOT NULL REFERENCES users(id),
  content     TEXT NOT NULL,
  is_internal BOOLEAN DEFAULT true,
  created_at  TIMESTAMPTZ DEFAULT NOW(),
  -- Ensure only one FK is set
  CONSTRAINT one_parent_only CHECK (
    (workflow_id IS NOT NULL)::int +
    (contact_id IS NOT NULL)::int +
    (task_id IS NOT NULL)::int = 1
  )
);

CREATE INDEX idx_notes_entity ON notes(entity_type, entity_id);
CREATE INDEX idx_notes_org ON notes(org_id);
CREATE INDEX idx_notes_workflow ON notes(workflow_id) WHERE workflow_id IS NOT NULL;
CREATE INDEX idx_notes_contact ON notes(contact_id) WHERE contact_id IS NOT NULL;
CREATE INDEX idx_notes_task ON notes(task_id) WHERE task_id IS NOT NULL;
```

#### `activity_log`
```sql
CREATE TABLE activity_log (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id      TEXT NOT NULL,
  user_id     TEXT REFERENCES users(id),
  entity_type TEXT NOT NULL,  -- 'workflow', 'contact', 'task' (for rendering)
  entity_id   UUID NOT NULL,
  -- Soft FKs for sane queries (nullable, indexed)
  workflow_id UUID REFERENCES workflows(id) ON DELETE CASCADE,
  contact_id  UUID REFERENCES contacts(id) ON DELETE CASCADE,
  task_id     UUID REFERENCES tasks(id) ON DELETE CASCADE,
  action      TEXT NOT NULL,  -- 'created', 'updated', 'deleted', 'status_changed'
  details     JSONB DEFAULT '{}',
  created_at  TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_activity_org ON activity_log(org_id);
CREATE INDEX idx_activity_entity ON activity_log(entity_type, entity_id);
CREATE INDEX idx_activity_time ON activity_log(created_at DESC);
CREATE INDEX idx_activity_workflow ON activity_log(workflow_id) WHERE workflow_id IS NOT NULL;
CREATE INDEX idx_activity_contact ON activity_log(contact_id) WHERE contact_id IS NOT NULL;
CREATE INDEX idx_activity_task ON activity_log(task_id) WHERE task_id IS NOT NULL;
```

#### `formstack_config`
```sql
CREATE TABLE formstack_config (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id          TEXT NOT NULL UNIQUE,
  webhook_secret  TEXT,
  field_mappings  JSONB DEFAULT '{}',  -- maps Formstack field IDs to our fields
  default_template_id UUID REFERENCES workflow_definitions(id),
  is_active       BOOLEAN DEFAULT true,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  updated_at      TIMESTAMPTZ DEFAULT NOW()
);
```

#### `formstack_submissions`
```sql
CREATE TABLE formstack_submissions (
  id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  org_id          TEXT NOT NULL,
  form_id         TEXT NOT NULL,
  submission_id   TEXT NOT NULL,
  raw_payload     JSONB NOT NULL,
  processed       BOOLEAN DEFAULT false,
  workflow_id     UUID REFERENCES workflows(id),
  error           TEXT,
  created_at      TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(org_id, submission_id)  -- Prevent duplicate webhook processing
);

CREATE INDEX idx_formstack_org ON formstack_submissions(org_id);
CREATE INDEX idx_formstack_processed ON formstack_submissions(processed) WHERE NOT processed;

-- Note: UNIQUE constraint prevents duplicate webhooks (Formstack retries on failure)
```

---

## Technical Stack

| Layer | Technology | Notes |
|-------|-----------|-------|
| Framework | Next.js 16.1.6 | App Router, React Server Components |
| React | 19.2.3 | Latest stable |
| Language | TypeScript 5 | Strict mode |
| Auth | Clerk | Organizations for multi-tenant |
| Database | Neon PostgreSQL | Serverless Postgres (application data) |
| Workflow Engine | Temporal.io (Cloud) | Durable workflow orchestration (TypeScript SDK) |
| API/Backend | Next.js API Routes + Temporal Workers | Edge functions, workflow execution |
| ORM | Drizzle | TypeScript-first (not implemented yet) |
| Styling | Tailwind CSS 4 | CSS variables for theming |
| UI Components | shadcn/ui + Radix | Accessible primitives |
| State Management | TanStack Query | Server state (not implemented yet) |
| Forms | React Hook Form + Zod | Validation (not implemented yet) |
| File Storage | Vercel Blob | For v1, migrate to R2 later |
| Deployment | Vercel (frontend) + Temporal Cloud + Railway (workers) | Use Temporal Cloud for MVP (avoid ops overhead) |

---

## Workflow Architecture

**Byte Dashboard is a workflow automation platform** that orchestrates multi-step processes involving external integrations and long-running operations. Unlike simple CRUD workflow_executions, workflows can span hours, days, or weeks while waiting for external events.

### Why Temporal.io?

**The Problem:** Workflows involve:
- Multi-step processes triggered by external events (Formstack submissions)
- Operations that bounce between internal (DB) and external systems (email, forms, background checks)
- Async step-to-step progression with waits for external responses (days/weeks)
- Example: Application review â†’ email hiring manager â†’ **wait for task completion** â†’ send background check form â†’ **wait for submission** â†’ call external API â†’ schedule interview

**Why Not Simple API Routes?**
- API routes are stateless and can't "wait" for days
- No built-in retry logic or failure handling
- Can't survive server restarts mid-process
- No way to wait for external signals (form submissions, task completions)

**Temporal's Solution:**
- **Durable execution**: Workflows survive server restarts
- **Signal/wait patterns**: Can pause for external events (task completion, webhook, user action)
- **Automatic retries**: Configurable backoff and timeout handling
- **Long-running support**: Workflows can run for hours, days, or weeks
- **TypeScript SDK**: Full type safety, integrates with Next.js
- **Industry proven**: Used by Netflix, Stripe, Snap, Datadog

### How Workflows Work

```
External Event (Formstack webhook)
    â†“
API Route (app/api/webhooks/formstack)
    â†“
Start Temporal Workflow
    â†“
Workflow orchestrates:
    1. Activity: Create contact in DB (Drizzle)
    2. Activity: Create application in DB
    3. Activity: Send notification email
    4. Activity: Create review task
    5. Wait for Signal: task_completed
       â†“ (hours/days later)
    6. Activity: Send background check form
    7. Wait for Signal: form_submitted
       â†“ (days/weeks later)
    8. Activity: Call external API
    9. Activity: Update application status
    â†“
Workflow Complete
```

### Workflows vs. Activities

**Workflows** (in `lib/workflows/`)
- Orchestration logic only (what to do, in what order)
- Can wait for signals and timers
- Deterministic (no direct I/O)
- Example: `onboarding-workflow.ts`, `background-check.ts`

**Activities** (in `lib/activities/`)
- Actual work (database, API calls, emails)
- Non-deterministic operations
- Retryable
- Example: `database.ts`, `email.ts`, `integrations.ts`

### Integration Points

1. **Formstack Webhook** â†’ API Route â†’ Start Workflow
2. **Task Completion** (UI) â†’ API Route â†’ Signal Workflow
3. **Form Submission** (external) â†’ Webhook â†’ Signal Workflow
4. **Admin Actions** (UI) â†’ API Route â†’ Signal Workflow

### Workflow State Management

- **Business Data**: PostgreSQL (via Drizzle) - contacts, workflow_definitions, workflow_executions, tasks
- **Workflow State**: Temporal's persistence layer - execution history, timers, signals
- **Workflow Templates**: PostgreSQL - UI metadata (statuses, colors, labels for frontend)

The `workflow_definitions` table stores UI configuration (status badges, colors, labels), while Temporal handles the actual execution, retries, and durability.

**Critical Invariant: UI Status â‰  Execution State**

The `workflows.status` field is **presentation-only**. Temporal workflow state is authoritative.

**Rules:**
1. UI status changes must signal Temporal (not direct DB updates)
2. Status updates are derived from Temporal workflow outcomes
3. Never allow status dropdowns that bypass Temporal signals

**Example:**
```typescript
// âŒ WRONG: Direct status update
UPDATE workflows SET status = 'approved' WHERE id = ?;

// âœ… CORRECT: Signal Temporal, workflow activity updates status
await temporalClient.workflow.signal(workflowId, 'approve', { reason: '...' });
// Temporal workflow activity updates workflows.status as side effect
```

This prevents desyncing UI state from actual workflow progression.

---

## Frontend Structure (Current)

```
frontend/
â”œâ”€â”€ app/                         # Next.js App Router
â”‚   â”œâ”€â”€ (dashboard)/            # Route group with shared layout
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Sidebar + top navigation
â”‚   â”‚   â”œâ”€â”€ dashboard/          # Main dashboard view
â”‚   â”‚   â”œâ”€â”€ workflows/          # Workflow management (was "workflow_executions")
â”‚   â”‚   â”œâ”€â”€ people/             # Contact/people management
â”‚   â”‚   â”œâ”€â”€ tasks/              # Task management
â”‚   â”‚   â”œâ”€â”€ my-work/            # Personal work view
â”‚   â”‚   â”œâ”€â”€ calendar/           # Calendar view
â”‚   â”‚   â”œâ”€â”€ support/            # Support section
â”‚   â”‚   â””â”€â”€ admin/              # Admin section
â”‚   â”‚       â”œâ”€â”€ settings/       # Settings with tab-based sub-navigation
â”‚   â”‚       â”‚   â”œâ”€â”€ layout.tsx  # Shared tabs for all settings pages
â”‚   â”‚       â”‚   â”œâ”€â”€ general/
â”‚   â”‚       â”‚   â”œâ”€â”€ billing/
â”‚   â”‚       â”‚   â”œâ”€â”€ users/
â”‚   â”‚       â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚       â”‚   â”œâ”€â”€ audit/
â”‚   â”‚       â”‚   â”œâ”€â”€ crm/
â”‚   â”‚       â”‚   â””â”€â”€ customizations/
â”‚   â”‚       â””â”€â”€ workflow-blueprints/  # Manage workflow templates
â”‚   â”œâ”€â”€ globals.css             # Tailwind v4 imports + CSS variables
â”‚   â””â”€â”€ layout.tsx              # Root layout with theme provider
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                     # shadcn/ui components (DO NOT edit)
â”‚   â”œâ”€â”€ layout/                 # app-sidebar, page-header
â”‚   â”œâ”€â”€ data-table/             # Reusable DataTable with TanStack Table
â”‚   â”œâ”€â”€ workflows/              # Workflow-specific components
â”‚   â”œâ”€â”€ contacts/               # Contact-specific components
â”‚   â”œâ”€â”€ tasks/                  # Task-specific components
â”‚   â”œâ”€â”€ assets/                 # Asset/document components (NEW)
â”‚   â”œâ”€â”€ kanban/                 # Kanban board with dnd-kit
â”‚   â”œâ”€â”€ dashboard/              # Dashboard widgets
â”‚   â”œâ”€â”€ detail/                 # Detail page components
â”‚   â””â”€â”€ common/                 # Shared presentational components
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ data/                   # Mock data for development
â”‚   â”‚   â”œâ”€â”€ workflows.ts        # (was workflow_executions.ts)
â”‚   â”‚   â”œâ”€â”€ contacts.ts
â”‚   â”‚   â”œâ”€â”€ tasks.ts
â”‚   â”‚   â”œâ”€â”€ activity.ts
â”‚   â”‚   â””â”€â”€ settings.ts
â”‚   â”œâ”€â”€ db/                     # Database layer (Drizzle)
â”‚   â”‚   â”œâ”€â”€ index.ts            # DB connection
â”‚   â”‚   â”œâ”€â”€ schema.ts           # Drizzle schema
â”‚   â”‚   â””â”€â”€ queries.ts          # Reusable queries
â”‚   â”œâ”€â”€ workflows/              # Temporal workflows
â”‚   â”‚   â”œâ”€â”€ onboarding-workflow.ts
â”‚   â”‚   â””â”€â”€ background-check.ts
â”‚   â”œâ”€â”€ activities/             # Temporal activities
â”‚   â”‚   â”œâ”€â”€ database.ts         # DB operations
â”‚   â”‚   â”œâ”€â”€ email.ts            # Email sending
â”‚   â”‚   â””â”€â”€ integrations.ts     # External API calls
â”‚   â”œâ”€â”€ temporal/               # Temporal setup
â”‚   â”‚   â”œâ”€â”€ client.ts           # Temporal client
â”‚   â”‚   â””â”€â”€ worker.ts           # Temporal worker
â”‚   â”œâ”€â”€ validations/            # Zod schemas
â”‚   â”œâ”€â”€ design-tokens.ts        # Semantic color mappings
â”‚   â”œâ”€â”€ status-config.ts        # Badge variants for statuses/priorities
â”‚   â””â”€â”€ utils.ts                # Utility functions (cn, etc.)
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                # TypeScript types for all domain models
â”œâ”€â”€ hooks/                      # Custom React hooks
â””â”€â”€ middleware.ts               # Clerk authentication (DELETED - needs restoration)
```

---

## V1 Scope

### âœ… In Scope

#### 1. Foundation (âœ“ Complete)
- [x] Next.js 16 project initialized
- [x] Clerk authentication integrated
- [x] Basic role system (Admin, Member, Viewer)
- [x] Layout with sidebar navigation
- [x] Tailwind CSS v4 + shadcn/ui components
- [x] Theme switching (light/dark)
- [ ] Middleware for Clerk route protection (needs restoration)
- [ ] Temporal.io setup and configuration
- [ ] Temporal worker deployment
- [ ] Basic workflow orchestration patterns

#### 2. Contacts Module
- [ ] Contact list page (table with search/filter)
- [ ] Contact detail page
- [ ] Create contact form
- [ ] Edit contact
- [ ] Delete contact with confirmation

#### 3. Workflow Executions Module
- [ ] Workflow list page (table with filters)
- [ ] Workflow detail page
- [ ] Create workflow (manual)
- [ ] Edit workflow
- [ ] Status field with dropdown
- [ ] Link workflow to contact
- [ ] Simple status progression (config-based, not visual builder)

#### 4. Tasks & Kanban
- [ ] Task list page
- [ ] Create task form
- [ ] Assign task to user
- [ ] Due date picker
- [ ] Task status (todo, in_progress, done)
- [ ] Link task to workflow or contact
- [ ] Kanban board view
- [ ] Drag-and-drop between columns

#### 5. Assets/Documents (v1.5 - Not MVP)
Assets introduce storage lifecycle, quotas, permissions, preview logic, and orphan cleanup. Deferred to v1.5.

**MVP Stub:**
- [ ] Stub assets table in schema
- [ ] Basic upload endpoint (store file, return URL)
- [ ] Basic download endpoint (return signed URL)
- **No** previews, metadata UI, thumbnails, or task attachments in v1

#### 6. Dashboard
- [ ] Workflow count by status (pie/bar chart)
- [ ] Recent workflows list
- [ ] My tasks widget
- [ ] Workflows over time (line chart)
- [ ] Activity feed widget

#### 7. Calendar
- [ ] Calendar view displays tasks by due date
- [ ] Month/week views
- [ ] Link to task details

#### 8. Settings
- [x] Settings page structure with tabs
- [ ] General settings (org info, preferences)
- [ ] User management (invite, edit, remove)
- [ ] Billing & plans (view/upgrade)
- [ ] Integrations (Formstack config)
- [ ] Audit logs (activity history)
- [ ] Workflow templates management

#### 9. Formstack Integration
- [ ] API route for Formstack webhook
- [ ] Webhook signature verification
- [ ] Field mapping config
- [ ] Temporal workflow triggered by webhook
- [ ] Workflow orchestrates: create contact â†’ create workflow execution â†’ send notifications â†’ create tasks
- [ ] Signal/wait patterns for external events (task completion, form submission)
- [ ] Log ingestion in activity_log

#### 10. Data & Exports
- [ ] CSV export for workflows
- [ ] CSV export for contacts
- [ ] Basic PDF report (workflow summary)

### âŒ Explicitly Out of Scope

Features deferred to v1.5+:

- **Asset Management (v1.5)**: Previews, thumbnails, metadata UI, quotas, task attachments
- Visual drag-and-drop workflow builder
- Dynamic form builder
- AI assistant (BYTE)
- Payment processing / Stripe integration
- Advanced document features (OCR, version control, e-signatures)
- Email notifications system
- Calendar integrations (Google/Outlook sync)
- Advanced integrations beyond Formstack
- Bulk import/export
- Custom fields UI (use JSONB for now)
- Advanced reporting / analytics
- Real-time collaboration
- Mobile app
- Production deployment optimization
- Comprehensive test coverage

---

## Success Criteria

MVP is complete when:

1. âœ… New org can sign up via Clerk
2. âœ… Formstack webhook creates workflows automatically
3. âœ… Users can view/manage workflows and contacts
4. âœ… Documents can be uploaded and attached to workflows
5. âœ… Tasks can be created, assigned, and tracked via Kanban
6. âœ… Dashboard shows pipeline overview
7. âœ… Data can be exported to CSV
8. âœ… All data is properly scoped to organization
9. âœ… No cross-tenant data leakage

---

## Timeline & Deliverables

**Total Duration:** 2 weeks (30 hours)

### Phase 1: Foundation (Week 1, 15 hours)

#### P1-A: Foundation Setup & Authentication
- [x] Next.js 16 project initialized
- [x] Clerk authentication integrated
- [x] Users can sign up, sign in, manage profile
- [x] Basic role system (Admin, Member, Viewer)
- [x] Layout with sidebar navigation
- [ ] Middleware for org-scoped routes

#### P1-B: Database Schema & Base Components
- [ ] Neon database configured
- [ ] Drizzle schema setup (10-11 tables)
- [ ] Initial migrations
- [ ] Database connection utilities
- [x] Base UI components library (shadcn/ui)
- [x] Data table component with sorting/filtering

#### P1-C: Temporal Setup
- [ ] Install @temporalio/client and @temporalio/worker
- [ ] Configure Temporal connection (local dev or Temporal Cloud)
- [ ] Set up worker process
- [ ] Create first simple workflow (hello world)
- [ ] Test workflow execution locally

### Phase 2: Core CRUD (Week 1-2, 15 hours)

#### P2-A: Contacts/People Module
- [ ] Contact list view with data table
- [ ] Contact detail page
- [ ] Add/edit contact forms
- [ ] Search and filter by name, email, status
- [ ] Contact deletion with confirmation
- [ ] All CRUD operations persist to database

#### P2-B: Workflow Executions Module
- [ ] Workflow list view with status filters
- [ ] Workflow detail page (shows linked contact)
- [ ] Add/edit workflow forms
- [ ] Simple status workflow
- [ ] Workflows linked to contacts correctly
- [ ] Status change tracking

### Phase 3: Tasks & Features (Week 2, 15 hours)

#### P3-A: Tasks & Kanban Board
- [ ] Kanban board displays tasks by status
- [ ] Drag-and-drop to change task status
- [ ] Add/edit/delete tasks
- [ ] Assign tasks to users
- [ ] Task filtering by assignee
- [ ] All task data persists correctly

#### P3-B: Dashboard & Basic Assets Stub
- [ ] Dashboard displays key metrics
- [ ] Recent activity feed
- [ ] Quick action buttons
- [ ] Statistics update with data changes
- [ ] **Assets table stubbed**
- [ ] **Basic upload endpoint only (no UI)**
- [ ] **File download via signed URL**
- **No** previews, thumbnails, metadata UI, or task attachments (v1.5)

### Phase 4: Polish & Integration (Week 2, 15 hours)

#### P4-A: Calendar & Settings
- [ ] Calendar view displays tasks by due date
- [ ] Month/week views functional
- [ ] Settings pages (general, users, billing)
- [ ] User management (invite/edit/remove)
- [ ] General settings persist correctly

#### P4-B: Formstack Integration & Testing
- [ ] Formstack webhook endpoint
- [ ] Field mapping configuration
- [ ] Temporal workflow triggered by webhook
- [ ] Workflow orchestrates contact/workflow execution creation
- [ ] Signal handling for task completion
- [ ] Timeout/retry configuration
- [ ] All CRUD operations tested
- [ ] Core user flows functional
- [ ] Code documented
- [ ] README with setup instructions

---

## Key Architecture Decisions

### 1. Temporal Workflows (Not Simple Status Sequences)

**Workflows are managed by Temporal**, not simple status transitions. The `workflow_definitions` table stores UI metadata (status labels, colors, badges for the frontend), while Temporal handles execution, retries, and durability.

**Example Workflow Code:**

```typescript
// lib/workflows/application-review.ts
import { proxyActivities, defineSignal, setHandler, condition } from '@temporalio/workflow';
import type * as activities from '../activities';

const { createContact, createApplication, sendEmail, createTask } = proxyActivities<typeof activities>({
  startToCloseTimeout: '5 minutes',
  retry: { maximumAttempts: 3 }
});

// Define signals for external events
const taskCompletedSignal = defineSignal<[string]>('taskCompleted');
const formSubmittedSignal = defineSignal<[object]>('formSubmitted');

export async function applicationReviewWorkflow(formData: FormstackSubmission) {
  // Step 1: Create contact and application
  const contact = await createContact(formData);
  const application = await createApplication(contact.id, formData);

  // Step 2: Send notification to hiring manager
  await sendEmail({
    to: 'hiring@example.com',
    template: 'new_application',
    data: { contact, application }
  });

  // Step 3: Create review task
  const reviewTask = await createTask({
    title: 'Review application',
    applicationId: application.id,
    assignedTo: 'hiring-manager-id'
  });

  // Step 4: Wait for task completion (could be hours/days)
  let taskId: string | undefined;
  setHandler(taskCompletedSignal, (id: string) => { taskId = id });
  await condition(() => taskId === reviewTask.id, '7 days'); // timeout after 7 days

  // Step 5: Send background check form
  await sendEmail({
    to: contact.email,
    template: 'background_check_form',
    data: { contact }
  });

  // Step 6: Wait for form submission (could be days/weeks)
  let formResponse: object | undefined;
  setHandler(formSubmittedSignal, (data: object) => { formResponse = data });
  await condition(() => formResponse !== undefined, '14 days');

  // Step 7: Process background check
  // ... more steps

  return { success: true, applicationId: application.id };
}
```

**Key Points:**
- **Durable**: Survives server restarts
- **Signal/Wait**: Can pause for external events (task completion, form submission)
- **Timeouts**: Configurable wait limits
- **Retries**: Automatic retry with backoff
- **UI Metadata**: `workflow_definitions` table still defines statuses for badges/filters in frontend

### 2. JSONB for Flexibility
- Custom fields on contacts: `metadata` JSONB column
- Workflow status definitions: `statuses` JSONB array
- Form field mappings: `field_mappings` JSONB object
- Activity details: `details` JSONB object

### 3. Clerk Handles Auth
- No custom auth tables
- Organizations = tenants
- Webhook syncs users to local table for app data
- Roles via Clerk's built-in system

### 4. One Tasks Table
Both workflow tasks AND manual tasks live in the same table:
- Workflow task: has `workflow_id` and `stage` fields
- Manual task: `workflow_id` nullable, `task_type = 'manual'`

### 5. Assets Storage
- V1: Vercel Blob (simple, integrated)
- Future: Cloudflare R2 (cheaper, unlimited egress)
- Storage quota tracked per organization

### 6. Polymorphic Relations with Soft FKs
`notes` and `activity_log` use hybrid approach:
- **entity_type + entity_id**: For flexible polymorphic rendering
- **Nullable FKs** (workflow_id, contact_id, task_id): For sane queries, FK guarantees, indexed lookups
- **Constraint**: Ensures exactly one FK is set per row
- **Result**: Flexibility without N+1 queries or complex unions

Example query:
```sql
-- Get all activity for a workflow (fast, uses index)
SELECT * FROM activity_log WHERE workflow_id = ?;

-- Get all activity for any entity (still works)
SELECT * FROM activity_log WHERE entity_type = 'workflow' AND entity_id = ?;
```

---

## Development Guidelines

### Component Organization
- Use PascalCase for components
- Use camelCase for hooks (prefix with `use`)
- Route folders in kebab-case (`/my-work`, `/workflow-blueprints`)
- Co-locate entity-specific logic by domain

### Styling
- Use Tailwind utilities, maintain order: layout, spacing, color, state
- Theme all colors through CSS variables (defined in `globals.css`)
- Use semantic tokens from `lib/design-tokens.ts`
- Never hardcode color values

### Type Safety
- All types in `types/index.ts`
- Use `type` for unions/primitives
- Use `interface` for objects that may be extended
- Avoid `any` - lift types to shared location

### Import Paths
- Use `@/*` alias (resolves to `frontend/*`)
- Never use deep relative paths like `../../../components`

### Testing (Post-V1)
- Add React Testing Library or Vitest
- Co-locate tests: `Component.test.tsx`
- Integration tests in `app/__tests__/`

---

## Open Questions

To resolve before/during build:

1. **Formstack account access** - Need credentials and form IDs to test integration
2. **Existing data migration** - Any real data in old system that needs migration?
3. **Specific fields required** - Get final list of contact/workflow fields from FCSO
4. **Status workflow specifics** - Confirm the exact stages for their process
5. **User list** - Who needs accounts for initial pilot?
6. **Compliance requirements** - Any specific security certifications needed at launch?
7. **File storage limits** - What's acceptable per-org quota for v1?

---

## References

- **Old Codebase** - Use for domain knowledge, not implementation
  - Data model: `src/integrations/supabase/types.ts`
  - UI components: `src/components/ui/`
  - Business logic examples: `src/contexts/AuthContext.ts`
  - Formstack integration: `supabase/functions/formstack*/`

- **Documentation Files**
  - `CLAUDE.md` - Codebase and development instructions
  - `AGENTS.md` - Repository guidelines
  - `byte reference/MVP_ROADMAP.md` - Original MVP plan
  - `byte reference/CODEBASE_AUDIT.md` - Why we're rebuilding
  - `byte reference/SCHEMA_BREAKDOWN.md` - Old vs new data model
  - `byte reference/UI_ELEMENTS.md` - UI components reference

---

## Current Status (February 6, 2026)

### âœ… Complete
- Next.js 16 project scaffold
- Clerk integration (basic)
- Layout components (sidebar, header)
- Settings page structure with tabs
- Mock data for development
- shadcn/ui component library
- Tailwind CSS v4 configuration
- Theme system (light/dark)
- Design tokens and semantic colors

### ğŸš§ In Progress
- None (awaiting direction)

### â³ Next Steps
1. Restore/recreate Clerk middleware for route protection
2. Set up Neon database + Drizzle ORM
3. Implement Contacts CRUD
4. Build Workflows module
5. Add Assets/Documents management
6. Connect Formstack webhook

---

## Notes

- This is a **2-week MVP**, not enterprise software
- Hardcode things initially, add configurability later
- Ship first, optimize later
- Focus on the core loop: Form â†’ Contact â†’ Workflow â†’ Tasks â†’ Documents
- Everything else is scope creep
